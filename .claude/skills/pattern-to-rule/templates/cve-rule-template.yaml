# CVE Rule Template
# Copy this file and replace placeholders

rules:
  - id: cve-YYYY-NNNNN-vulnerability-type
    # Use 'taint' for injection vulnerabilities (recommended)
    # Use 'search' (default) for simple pattern matching
    mode: taint
    languages:
      - python  # Change to target language(s)

    message: |
      [One sentence describing what was detected and why it's dangerous]

      This pattern is similar to CVE-YYYY-NNNNN which affected [package].

      Impact: [What an attacker can do - RCE, data theft, etc.]

      Remediation: [Specific fix instructions]
      ```
      [Code example of safe alternative]
      ```

    severity: ERROR  # CRITICAL, ERROR, WARNING, INFO

    metadata:
      cve: "CVE-YYYY-NNNNN"
      cwe: "CWE-XX"
      cvss: "X.X"
      owasp: "A0X:2021 - Category Name"
      confidence: HIGH  # HIGH, MEDIUM, LOW
      likelihood: HIGH  # HIGH, MEDIUM, LOW
      impact: HIGH      # HIGH, MEDIUM, LOW
      category: security
      subcategory:
        - vuln
      technology:
        - framework-name
      references:
        - https://nvd.nist.gov/vuln/detail/CVE-YYYY-NNNNN
        - https://github.com/owner/repo/commit/HASH
        - https://advisory-or-writeup-url

    # === TAINT MODE CONFIGURATION ===

    pattern-sources:
      # Flask
      - pattern: request.args.get(...)
      - pattern: request.args[...]
      - pattern: request.form.get(...)
      - pattern: request.form[...]
      - pattern: request.json
      - pattern: request.json.get(...)
      - pattern: request.json[...]
      - pattern: request.data

      # Django
      - pattern: request.GET.get(...)
      - pattern: request.GET[...]
      - pattern: request.POST.get(...)
      - pattern: request.POST[...]

      # Add framework-specific sources as needed

    pattern-sinks:
      # Primary sink from CVE
      - pattern: dangerous_function($PARAM)
        focus-metavariable: $PARAM

      # Variant sinks
      - pattern: other_dangerous_function($PARAM)
        focus-metavariable: $PARAM

    pattern-sanitizers:
      # Safe wrappers that neutralize the threat
      - pattern: sanitize_function(...)
      - pattern: validate_function(...)

      # Type conversions (if applicable)
      - pattern: int(...)
      - pattern: str(...)

      # Framework-specific safe patterns
      # - pattern: ...

    # === PATH EXCLUSIONS ===

    paths:
      exclude:
        - "**/test/**"
        - "**/tests/**"
        - "**/test_*.py"
        - "**/*_test.py"
        - "**/fixtures/**"
        - "**/examples/**"

    # === OPTIONS (uncomment if needed) ===

    # options:
    #   interfile: true  # Cross-file analysis (requires --pro)
    #   constant_propagation: true  # Track constants

# =============================================================================
# PATTERN MODE ALTERNATIVE (for simple matches without data flow)
# =============================================================================
# Uncomment and modify if taint mode is not needed
#
#   - id: cve-YYYY-NNNNN-pattern
#     languages: [python]
#     severity: ERROR
#     message: ...
#
#     patterns:
#       - pattern: dangerous($INPUT)
#       - pattern-not: dangerous("...")  # Exclude hardcoded
#       - pattern-not-inside: |
#           def test_...():
#               ...
