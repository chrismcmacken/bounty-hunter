# High-Value CVE Patterns for Custom Semgrep Rules

Research findings for creating custom detection rules targeting critical web vulnerabilities.

## Priority 1: CVSS 10.0 (Critical)

### CVE-2025-55182 - React Server Components RCE (React2Shell)
**CVSS:** 10.0 | **Type:** Insecure Deserialization | **Actively Exploited**

**Vulnerable Pattern:**
- React Server Components using Flight protocol
- Deserialization of untrusted HTTP request bodies
- Affects: react-server packages 19.0, 19.1.0, 19.1.1, 19.2.0

**Detection Approach:**
```yaml
# Detect RSC Flight protocol usage in vulnerable versions
patterns:
  - pattern: import { ... } from 'react-server-dom-webpack/server'
  - pattern: import { ... } from 'react-server-dom-webpack/client'
  - pattern: renderToReadableStream(...)
```

**Affected Frameworks:** Next.js, React Router, Waku, @parcel/rsc, @vitejs/plugin-rsc

**References:**
- https://www.wiz.io/blog/critical-vulnerability-in-react-cve-2025-55182
- https://www.akamai.com/blog/security-research/cve-2025-55182-react-nextjs-server-functions-deserialization-rce

---

### CVE-2025-66478 - Next.js RCE (Related to React2Shell)
**CVSS:** 10.0 | **Type:** Insecure Deserialization

**Vulnerable Versions:** Next.js < 15.0.5, 15.1.9, 15.2.6, 15.3.6, 15.4.8, 15.5.7, 16.0.7

**Detection Approach:**
```yaml
# Check package.json for vulnerable Next.js versions
patterns:
  - pattern-regex: '"next":\s*"(\^)?(14\.|15\.0\.[0-4]|15\.1\.[0-8])'
```

---

## Priority 2: CVSS 9.8-9.9 (Critical)

### CVE-2024-4879 - ServiceNow Jelly Template Injection
**CVSS:** 9.3 | **Type:** Server-Side Template Injection | **Actively Exploited**

**Vulnerable Pattern:**
```
GET /login.do?jvar_page_title=<style><j:jelly xmlns:j="jelly"><g:evaluate>CODE</g:evaluate></j:jelly></style>
```

**Detection Approach (for custom implementations):**
```yaml
# Jelly template injection sinks
patterns:
  - pattern: <g:evaluate>$USER_INPUT</g:evaluate>
  - pattern: GlideEvaluator.evaluateString($USER_INPUT)
```

**References:**
- https://www.cyfirma.com/research/servicenow-rce-cve-2024-4879-vulnerability-analysis-and-exploitation/

---

### CVE-2024-6386 - WPML Twig SSTI (WordPress)
**CVSS:** 9.9 | **Type:** Server-Side Template Injection

**Vulnerable Pattern:**
- Shortcode `[wpml_language_switcher]` with Twig template content
- `WPML_LS_Public_API::render()` processes Twig without sanitization

**Detection Approach:**
```yaml
# Twig template injection in PHP
patterns:
  - pattern: $twig->render($USER_INPUT, ...)
  - pattern: $twig->createTemplate($USER_INPUT)
  - pattern-inside: |
      $twig = new \Twig\Environment(...);
      ...
      $twig->render($USER_INPUT);
```

**Twig RCE Payloads to Detect:**
```yaml
# Dangerous Twig filter usage
patterns:
  - pattern-regex: '\{\{.*\|filter\s*\('
  - pattern-regex: '\{\{.*\|map\s*\('
  - pattern-regex: '\{\{.*\|reduce\s*\('
```

**References:**
- https://blog.wpsec.com/the-full-story-of-cve-2024-6386-remote-code-execution-in-wpml/
- https://sec.stealthcopter.com/wpml-rce-via-twig-ssti/

---

### CVE-2024-28986 - SolarWinds Web Help Desk Java Deserialization
**CVSS:** 9.8 | **Type:** Java Deserialization

**Detection Approach:**
```yaml
# Java deserialization sinks
patterns:
  - pattern: new ObjectInputStream($INPUT).readObject()
  - pattern: $OIS.readObject()
  - pattern-inside: |
      ObjectInputStream $OIS = ...;
      ...
      $OIS.readObject();
```

---

### CVE-2024-12828 - Webmin Command Injection
**CVSS:** 9.9 | **Type:** OS Command Injection

**Detection Approach:**
```yaml
# Perl command injection
patterns:
  - pattern: system($USER_INPUT)
  - pattern: `$USER_INPUT`
  - pattern: open($FH, "|$USER_INPUT")
  - pattern: exec($USER_INPUT)
```

---

## Priority 3: CVSS 9.0+ (High-Critical)

### CVE-2024-34351 - Next.js SSRF
**CVSS:** 7.5 | **Type:** Server-Side Request Forgery

**Vulnerable Pattern:**
- Server Actions with redirect to relative path starting with `/`
- Modified `Host` header allows SSRF

**Detection Approach:**
```yaml
# Next.js Server Actions with redirect
patterns:
  - pattern: |
      'use server';
      ...
      redirect($PATH);
  - pattern-not: redirect('/static/...')
```

---

### CVE-2024-39338 - Axios SSRF
**CVSS:** 7.5 | **Type:** Server-Side Request Forgery

**Vulnerable Pattern:**
- axios 1.7.2 treats path-relative URLs as protocol-relative
- `axios.get('//attacker.com')` becomes external request

**Detection Approach:**
```yaml
# Axios with user-controlled URLs
patterns:
  - pattern: axios.get($USER_INPUT)
  - pattern: axios.post($USER_INPUT, ...)
  - pattern: axios.request({ url: $USER_INPUT, ... })
```

---

### CVE-2024-22259 - Spring Framework SSRF
**CVSS:** 8.1 | **Type:** Server-Side Request Forgery

**Vulnerable Pattern:**
- `UriComponentsBuilder` parsing external URLs with host validation bypass

**Detection Approach:**
```yaml
# Spring UriComponentsBuilder with user input
patterns:
  - pattern: UriComponentsBuilder.fromUriString($USER_INPUT)
  - pattern: UriComponentsBuilder.fromHttpUrl($USER_INPUT)
```

---

### CVE-2024-23692 - Rejetto HFS SSTI
**Type:** Server-Side Template Injection

**Detection Approach:**
```yaml
# HTTP File Server template injection patterns
patterns:
  - pattern-regex: '\{\..*\.\}'  # HFS macro syntax
```

---

## Template Injection Detection (Generic)

### Jinja2/Flask SSTI
```yaml
patterns:
  - pattern: render_template_string($USER_INPUT)
  - pattern: Template($USER_INPUT).render()
  - pattern: |
      from jinja2 import Template
      ...
      Template($USER_INPUT)
```

### EJS/Pug/Handlebars SSTI
```yaml
patterns:
  - pattern: ejs.render($USER_INPUT, ...)
  - pattern: pug.render($USER_INPUT, ...)
  - pattern: Handlebars.compile($USER_INPUT)
```

### Velocity SSTI
```yaml
patterns:
  - pattern: Velocity.evaluate($CONTEXT, $WRITER, $TAG, $USER_INPUT)
  - pattern: velocityEngine.evaluate($CONTEXT, $WRITER, $TAG, $USER_INPUT)
```

### Freemarker SSTI
```yaml
patterns:
  - pattern: new Template($NAME, new StringReader($USER_INPUT), $CFG)
  - pattern: Template.getPlainTextTemplate($NAME, $USER_INPUT, $CFG)
```

---

## Deserialization Detection (Generic)

### Java
```yaml
patterns:
  - pattern: ObjectInputStream($INPUT).readObject()
  - pattern: XMLDecoder($INPUT).readObject()
  - pattern: $YAML.load($USER_INPUT)  # SnakeYAML
```

### PHP
```yaml
patterns:
  - pattern: unserialize($USER_INPUT)
  - pattern: unserialize($USER_INPUT, ['allowed_classes' => true])
```

### Python
```yaml
patterns:
  - pattern: pickle.loads($USER_INPUT)
  - pattern: pickle.load($USER_INPUT)
  - pattern: yaml.load($USER_INPUT)  # without Loader=SafeLoader
  - pattern: yaml.unsafe_load($USER_INPUT)
```

### Ruby
```yaml
patterns:
  - pattern: Marshal.load($USER_INPUT)
  - pattern: YAML.load($USER_INPUT)
```

### .NET
```yaml
patterns:
  - pattern: BinaryFormatter.Deserialize($USER_INPUT)
  - pattern: XmlSerializer.Deserialize($USER_INPUT)
  - pattern: JsonConvert.DeserializeObject($USER_INPUT, new TypeNameHandling(...))
```

---

## Implementation Priority

1. **Immediate** (CVSS 10.0, actively exploited):
   - CVE-2025-55182 (React RSC)
   - CVE-2024-4879 (ServiceNow Jelly)

2. **High** (CVSS 9.5+, common frameworks):
   - CVE-2024-6386 (WPML Twig)
   - CVE-2024-28986 (Java Deserialization)
   - Generic SSTI patterns

3. **Medium** (CVSS 8.0+, requires specific conditions):
   - CVE-2024-34351 (Next.js SSRF)
   - CVE-2024-39338 (Axios SSRF)
   - CVE-2024-22259 (Spring SSRF)

---

## Resources

- [Semgrep Variant Analysis Guide](https://semgrep.dev/blog/2025/finding-more-zero-days-through-variant-analysis/)
- [0xdea Semgrep Rules](https://github.com/0xdea/semgrep-rules)
- [AutoGrep - LLM Rule Generation](https://lambdasec.github.io/AutoGrep-Automated-Generation-and-Filtering-of-Semgrep-Rules-from-Vulnerability-Patches/)
- [OpenSSF CVE Benchmark](https://github.com/ossf-cve-benchmark/ossf-cve-benchmark)
